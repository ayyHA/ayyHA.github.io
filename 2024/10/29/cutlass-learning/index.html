

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="cuteå…¥é—¨,cutlassæ‰¾é—¨,ç³Šæ¶‚å­¦,å¤šæ•´åˆ">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <meta name="description" content="cuteå…¥é—¨,cutlassæ‰¾é—¨,ç³Šæ¶‚å­¦,å¤šæ•´åˆ">
<meta property="og:type" content="article">
<meta property="og:title" content="cutlass-learning">
<meta property="og:url" content="http://example.com/2024/10/29/cutlass-learning/index.html">
<meta property="og:site_name" content="ayyHA&#39;s blog">
<meta property="og:description" content="cuteå…¥é—¨,cutlassæ‰¾é—¨,ç³Šæ¶‚å­¦,å¤šæ•´åˆ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2024/10/25/xdauKw1LvZ6kcqh.jpg">
<meta property="og:image" content="https://s2.loli.net/2024/10/25/nXwp7y9rAZP5siW.png">
<meta property="og:image" content="https://s2.loli.net/2024/10/25/D4P8tjZU5CF6Xr7.png">
<meta property="og:image" content="https://s2.loli.net/2025/03/07/8v5gBejcUw3zk9Y.png">
<meta property="article:published_time" content="2024-10-29T15:12:18.000Z">
<meta property="article:modified_time" content="2025-03-07T07:48:18.070Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Layout">
<meta property="article:tag" content="Tensor">
<meta property="article:tag" content="MMA">
<meta property="article:tag" content="Copy">
<meta property="article:tag" content="Swizzle">
<meta property="article:tag" content="cute">
<meta property="article:tag" content="cutlass2.x">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2024/10/25/xdauKw1LvZ6kcqh.jpg">
  
  <title>cutlass-learning - ayyHA&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/mouse.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"9c7ed39aa5906acb06d9f9cb7df236ae","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ayyHA</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="cutlass-learning">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2024-10-29 23:12" pubdate>
        2024å¹´10æœˆ29æ—¥ æ™šä¸Š
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7k å­—
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      22 åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">cutlass-learning</h1>
            
              <p class="note note-info">
                
                  æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2 ä¸ªæœˆå‰
                
              </p>
            
            <div class="markdown-body">
              <h2 id="cutlasså’Œcuteä½œç”¨"><a class="markdownIt-Anchor" href="#cutlasså’Œcuteä½œç”¨"></a> Cutlasså’ŒCuTeä½œç”¨</h2>
<p>CuTeæ˜¯ç”¨äºå†…å­˜æ’å¸ƒå’Œå¼ é‡è¡¨ç¤ºçš„æ¨¡æ¿å·¥å…·,cutlassæ˜¯ä»å¤šä¸ªå±‚é¢é€å±‚åˆ†è§£é€å±‚è§£è€¦çš„é«˜æ€§èƒ½æ¨¡æ¿åº“,CuTeæœ‰åˆ©äºä»£ç ç¼–å†™æ—¶ä¸ç”¨è¿‡äºå…³å¿ƒä¸€äº›æ•°æ®åç§»çš„è®¡ç®—,è€Œcutlassåˆ™å°†é«˜æ€§èƒ½ç®—å­å®ç°æ‹†è§£,å¦‚æœè¦å•ç‹¬å®ç°ä¸€ä¸ªç‰¹å®šçš„,å°±å¾—æŒ‰ç…§å®ƒçš„ä»£ç è§„èŒƒå®ç°ä¸€ä¸ª,ä¸ç„¶åªèƒ½ç”¨å®ƒå·²æœ‰çš„æ¨¡æ¿,å› æ­¤å­¦ä¹ CuTeæœ‰åˆ©äºæˆ‘ä»¬å¾ˆå¥½çš„å¤„ç†å¤æ‚çš„tensor,ä¸ç”¨æ•°æ ¼å­æ•°ä¸ªåŠæ­»,å­¦ä¹ cutlassçš„exampleå¯ä»¥è®©æˆ‘ä»¬å®ç°ç¼–å†™ä¸€äº›å·²æœ‰æ¨¡æ¿çš„ç®—å­,å¹¶ä¸”æ¥ä¸Šåç»­çš„æ¿€æ´»å‡½æ•°äºepilogue(ç®—å­èåˆç›¸å½“äº),å­¦ä¹ cutlassæºç æœ‰åˆ©äºæˆ‘ä»¬éµå¾ªå…¶è§„èŒƒç¼–å†™è‡ªå®šä¹‰é«˜æ€§èƒ½ç®—å­</p>
<p>cutlass2.xç”¨äº[Volta,Hopper) (â†è¿™æ˜¯ä¸ªåŒºé—´),cutlass3.xå› ä¸ºwgmma,tmaç­‰ä¸€å †æ–°ä¸œè¥¿,é‡å†™ä¸”å¢åŠ äº†å¾ˆå¤šæ–°ä¸œè¥¿,ä½†ä¹Ÿå®Œå…¨å…¼å®¹cutlass2.x,æ‰€ä»¥æ‰“å¥½2.xçš„åº•åº§æˆ‘ä¸ªäººæ„Ÿè§‰å¾ˆæœ‰å¿…è¦</p>
<h2 id="cutlass2x"><a class="markdownIt-Anchor" href="#cutlass2x"></a> Cutlass2.x</h2>
<h3 id="cutlasså››å¤§è½¯ä»¶æŠ½è±¡"><a class="markdownIt-Anchor" href="#cutlasså››å¤§è½¯ä»¶æŠ½è±¡"></a> cutlasså››å¤§è½¯ä»¶æŠ½è±¡</h3>
<ul>
<li><strong>æ¨¡æ¿æ¨å¯¼</strong>: ç±»ä¼¼äºGemmçš„DefaultGemm,é€šè¿‡åç‰¹åŒ–å±‚å±‚æ¨å¯¼</li>
<li><strong>æ•°æ®ç§»åŠ¨</strong>: é‡‡ç”¨éå¸¸æŠ½è±¡çš„**<code>Iteartor</code>**,è¿™ä¸ª<code>Iterator</code>æ˜¯ä¸€ä¸ªç¬¼ç»Ÿçš„æ¦‚å¿µ,å®ƒæœ‰<code>gmem-&gt;reg</code>,<code>gmem-&gt;smem</code>ç­‰å¥½å¤šä¸ªiterator,å®ƒéœ€è¦ç”¨åˆ°å¦‚<code>Layout</code>(æ•°æ®æ’å¸ƒ),<code>TensorMap</code>(æ¯ä¸ªthreadçš„åˆ†å·¥)ä¸€ç±»çš„,è¿˜æœ‰ä¸ª<code>Fragment</code>è¿™ä¸ªç±»,å®ƒæ˜¯æŠ½è±¡å¯„å­˜å™¨æ¥ç”¨,æœ¬è´¨æ˜¯ä¸ªä¸€ç»´å®šé•¿æ•°ç»„</li>
<li><strong>æ•°æ®è®¡ç®—</strong>: è®¡ç®—,æ¯”å¦‚<code>MmaTensorOp</code>å’Œ<code>MmaSimt</code>è¿™äº›ä¸ªç±»,ç”¨tensor coreè¿˜æ˜¯cuda core</li>
<li><strong>æµæ°´ç¼–æ’</strong>: å³æ˜¯è½¯æµæ°´,æ¯”å¦‚<code>MmaPipelined</code>å’Œ<code>MmaMultiStage</code>è¿™äº›ä¸ªç±»</li>
</ul>
<h3 id="cutlassæºç ç›®å½•åˆ†ç±»"><a class="markdownIt-Anchor" href="#cutlassæºç ç›®å½•åˆ†ç±»"></a> cutlassæºç ç›®å½•åˆ†ç±»</h3>
<p>include/cutlassä¸‹æ”¯æŒçš„è®¡ç®—çš„ç›®å½•:<strong>conv,epilogue,gemm,reduction</strong>;åˆ«çš„ç›®å½•æ˜¯è®¡ç®—å…¬ç”¨çš„:</p>
<ul>
<li>arch</li>
<li>conv</li>
<li>detail
<ul>
<li><code>help_macros.hpp</code>
<ul>
<li>ä¸€äº›æºç ä¸­å¸¸è§çš„å®å®šä¹‰,æ¯”å¦‚å¾ˆå¸¸è§çš„<code>CUTLASS_HOST_DEVICE</code>,å°±æ˜¯å¼ºåˆ¶å†…æ•›çš„<code>__device__ __host__</code>,å¾ªç¯å±•å¼€çš„ä»¥åŠå¯¹c++17çš„å®ç­‰ç­‰</li>
</ul>
</li>
</ul>
</li>
<li>epilogue</li>
<li>gemm</li>
<li>layout</li>
<li>pipeline</li>
<li>platform
<ul>
<li><code>platform.h</code>
<ul>
<li>å®å®šä¹‰ç”¨äºæ ‡æ³¨æ“ä½œç³»ç»Ÿä¿¡æ¯ã€æ ‡æ³¨ä¸€äº›ç©ºçš„å…³é”®å­—ï¼ˆä»¥ä½¿å¾—ä¸æ”¯æŒçš„c++æ ‡å‡†ä¹Ÿèƒ½ç¼–è¯‘ï¼‰ã€å¸¸é‡è¡¨è¾¾å¼éœ€è¦çš„å‡½æ•°(max,min);</li>
<li>stlå‡½æ•°å’Œç±»å‹çš„é‡æ–°å®ç°ï¼Œä»¥ä½¿å¾—èƒ½ç¼–è¯‘åœ¨è®¾å¤‡ç«¯(åŠ ä¸ª<code>__device__</code>å…³é”®å­—); ä½¿ç”¨çš„namespace: <code>platform</code></li>
<li>ä¸ºå½“å‰çš„c<ins>æ ‡å‡†æä¾›ä¸€äº›ä¼šç”¨åˆ°çš„ä½†æ˜¯å¯èƒ½æ˜¯åç»­æ¯”å¦‚c</ins>11/14/17â€¦æ‰æä¾›çš„stlå‡½æ•°å’Œç±»å‹ ; ä½¿ç”¨çš„namespace: <code>platform</code></li>
</ul>
</li>
</ul>
</li>
<li>reduction</li>
<li>thread</li>
<li>transform</li>
</ul>
<p>åœ¨include/cutlassä¸‹çš„å¤´æ–‡ä»¶çš„ä½œç”¨(æ…¢æ…¢çœ‹,æœ‰ç©ºlooklookå®ƒä»¬):</p>
<ul>
<li>
<p>aligned_buffer.h</p>
</li>
<li>
<p>array.h</p>
</li>
<li>
<p>array_planar_complex.h</p>
</li>
<li>
<p>array_subbyte.h</p>
</li>
<li>
<p>barrier.h</p>
</li>
<li>
<p>bfloat16.h</p>
</li>
<li>
<p>blas3.h</p>
</li>
<li>
<p>blas3_types.h</p>
</li>
<li>
<p>block_striped.h</p>
</li>
<li>
<p>cluster_launch.hpp</p>
</li>
<li>
<p>complex.h</p>
</li>
<li>
<p>constants.h</p>
</li>
<li>
<p>coord.h</p>
</li>
<li>
<p>core_io.h</p>
</li>
<li>
<p>cuda_host_adapter.hpp</p>
</li>
<li>
<p><code>cutlass.h</code></p>
<p>è¿™ä¸ªå¤´æ–‡ä»¶åšäº†<code>cutlass::Stauts</code>è¿™ä¸ªenum classçš„å®šä¹‰,è¿˜å®šä¹‰äº†warpã€warp groupçš„çº¿ç¨‹æ•°ç›®,ä¹Ÿæœ‰äº›ç®—lane_id,warp_id,warp_group_idçš„å°å‡½æ•°(ç”¨shfl_syncä½œå¹¿æ’­(warpIdé‚£äº›)åˆåŒæ­¥)</p>
</li>
<li>
<p>device_kernel.h</p>
</li>
<li>
<p>fast_math.h</p>
</li>
<li>
<p>float8.h</p>
</li>
<li>
<p>floating_point_nvrtc.h</p>
</li>
<li>
<p>functional.h</p>
</li>
<li>
<p>gemm_coord.h</p>
</li>
<li>
<p>gemm_coord.hpp</p>
</li>
<li>
<p>half.h</p>
</li>
<li>
<p>integer_subbyte.h</p>
</li>
<li>
<p>kernel_hardware_info.h</p>
</li>
<li>
<p>kernel_hardware_info.hpp</p>
</li>
<li>
<p>kernel_launch.h</p>
</li>
<li>
<p>matrix.h</p>
</li>
<li>
<p><code>trace.h</code> debugè·Ÿè¸ªä»£ç ç”¨</p>
</li>
</ul>
<p>ç‚¹è¿›å»å•ä¸ªè®¡ç®—å¦‚gemmç›®å½•,æœ‰<strong>device-&gt;kernel-&gt;threadblock-&gt;warp-&gt;thread</strong>è¿™å‡ ä¸ªç›®å½•(ç°åœ¨è¿˜æœ‰ä¸ª<strong>collective</strong>).åœ¨è¿™äº›ç›®å½•ä¸‹,æ–‡ä»¶åç”¨defaultä½œå‰ç¼€çš„æ˜¯è´Ÿè´£æ¨¡æ¿æ¨å¯¼çš„æ–‡ä»¶</p>
<ul>
<li>deviceå±‚ä¸»è¦æ˜¯è°ƒkernel,ç±»ä¼¼äºhostç«¯çš„åŠŸèƒ½,problemsizeé‚£äº›åœ¨è¿™é‡Œå¤„ç†,ç„¶ålaunch kernel;</li>
<li>kernelå±‚(è¿›å…¥åˆ°äº†deviceç«¯)è§£è€¦gemmå’Œepilogue,åŒæ—¶ç¡®ä¿äº†splitKçš„æ•°æ®ä¾èµ–,æ³¨æ„splitkæ˜¯å¤šä¸ªthreadblockè´Ÿè´£åŒä¸€ä¸ªç»“æœé˜µçš„éƒ¨åˆ†,è¿™ä¸ªæ ¸å‡½æ•°åšå®Œä¹‹åå¯¹å®ƒä»¬è¿›è¡Œå½’çº¦æ“ä½œ,sliceKåˆ™æ˜¯å¤šä¸ªwarpè´Ÿè´£åŒä¸€ä¸ªç»“æœé˜µçš„éƒ¨åˆ†,ç»“æŸååšä¸€æ¬¡å½’çº¦,è€Œæ­£å¸¸çš„æ˜¯iterationK,å³ä¸€ä¸ªtile size(threadblockè´Ÿè´£çš„å¤§å°)çš„kè·Ÿwarp sizeçš„kæ˜¯ç›¸åŒçš„,ä¸åŒåˆ™ä¸ºslickK,è€ŒsplitKæœ‰ä¸åŒçš„ä¸Šå±‚æ¨¡æ¿ç±»;</li>
<li>threadblockå±‚è´Ÿè´£æµæ°´ç¼–æ’å’Œå„ç§æ•°æ®ç§»åŠ¨,åˆå¤§åˆæ‚;</li>
<li>warp/thread: åšæ•°æ®è®¡ç®—çš„,æ­¤å¤–é‡Œé¢ä¼šå®šä¹‰ä¸€äº›ç§»åŠ¨çš„iteratorå¦‚smem-&gt;reg,ç„¶åç”±threadblockè°ƒ</li>
</ul>
<p>éƒ¨åˆ†åˆ«çš„ç›®å½•(include/cutlassä¸‹)çš„ä½œç”¨:</p>
<ul>
<li>conv: ç”±äºcutlassçš„convæ˜¯im2col + gemmå®ç°çš„,æ‰€ä»¥warp/threadç›®å½•çš„ä»£ç å¤§é‡å¤ç”¨gemmçš„;</li>
<li>epilogue: åªæœ‰threadblockä»¥ä¸‹çš„,æ¯•ç«Ÿä½ gemmå®Œåçš„æ•°æ®åœ¨regå³Fragmentå®ä¾‹é‡Œ,ç”±kernelå±‚å°†gemmçš„threadblockçš„Fragmentå¯¹è±¡ä¼ ç»™å°¾å¤„ç†,å³æ­¤åˆ»åªæœ‰ä»threadblockå¼€å§‹çš„æµç¨‹;</li>
<li>transform: è´Ÿè´£ä¸€äº›é€šç”¨çš„iterator,å¦‚gmem-&gt;regå’Œreg-&gt;smem</li>
</ul>
<p>ä»¥ä¸‹äºŒè€…æµæ°´ç¼–æ’(å‘ç”Ÿåœ¨threadblockå±‚)ç­–ç•¥çš„åŒºåˆ«:<mark>æè¿°åŒºåˆ«</mark></p>
<ul>
<li>pipelined</li>
<li>multistage</li>
</ul>
<h4 id="å‚è€ƒæ–‡ä»¶"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ä»¶"></a> å‚è€ƒæ–‡ä»¶</h4>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/ruc-whc/posts">çŸ¥ä¹åšä¸»-éœ¸ç‹æ‰‹æªè…¿-å››ç¯‡cutlassæºç å¯¼è¯»</a></li>
</ul>
<h3 id="exampleä»£ç æµ‹è¯•åŠ æºç ç†è§£"><a class="markdownIt-Anchor" href="#exampleä»£ç æµ‹è¯•åŠ æºç ç†è§£"></a> exampleä»£ç æµ‹è¯•åŠ æºç ç†è§£</h3>
<h3 id="æºç è§£è¯»ä¹‹gemmç³»åˆ—"><a class="markdownIt-Anchor" href="#æºç è§£è¯»ä¹‹gemmç³»åˆ—"></a> æºç è§£è¯»ä¹‹gemmç³»åˆ—</h3>
<p><mark>å…ˆæŠŠexampleçœ‹å®Œå†å¼„è¿™ä¸ª,ä¸€å¤§å¨</mark></p>
<h2 id="cute"><a class="markdownIt-Anchor" href="#cute"></a> CuTe</h2>
<h3 id="layout"><a class="markdownIt-Anchor" href="#layout"></a> Layout</h3>
<p>åœ¨cuteä½“ç³»ä¸‹,<strong>é€»è¾‘ç©ºé—´è¢«ç§°ä½œdomain</strong>,ä»£è¡¨å­˜å‚¨çš„<strong>ç‰©ç†ç©ºé—´è¢«ç§°ä½œcodomain</strong></p>
<p>å¯¹äºé€»è¾‘ç©ºé—´ä¸Šå…ƒç´ å¯¹åº”çš„ä½ç½®ç”¨coordinateè¡¨ç¤º,è€Œå®ƒæ¯ä¸ªä½ç½®çš„å…ƒç´ ä¹‹é—´çš„é—´éš”ç”¨strideçš„è¡¨ç¤º,é€šè¿‡å†…ç§¯å¯ä»¥å¾—åˆ°å¯¹åº”çš„ä¸€ç»´ç‰©ç†ç©ºé—´çš„åœ°å€,å³:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>=</mo><mo>âˆ‘</mo><mrow><mi>c</mi><mi>o</mi><mi>o</mi><mi>r</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>âˆ—</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>d</mi><mi>e</mi></mrow></mrow><annotation encoding="application/x-tex">index = \sum{coordinate * stride}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span></span></span></span></span></span></p>
<p><strong>Layoutæ˜¯ä¸ªå‡½æ•°ï¼Œç”±shapeå’Œstrideè¡¨è¾¾</strong>ï¼Œæ˜¯æ”¯æŒ<strong>å±‚æ¬¡åŒ–(hierarchy)çš„Tensor</strong>ï¼Œå³<strong>ä¸€ä¸ªshapeå¯ä»¥åµŒå¥—è¡¨è¾¾,åŒæ—¶strideåˆä¸shapeé‡Œçš„æ¯ä¸ªå‚æ•°ä¸€ä¸€å¯¹åº”</strong>ï¼š</p>
<p><code>shape((å†…tensorè¡Œ,å¤–tensorè¡Œ1,å¤–tensorè¡Œ2,...),(å†…tensoråˆ—ï¼Œå¤–tensoråˆ—1,å¤–tensoråˆ—2,...),...)</code></p>
<p>è¿™å…¶ä¸­çš„ä¸€äº›å±æ€§å¦‚:</p>
<ul>
<li>shapeé€šè¿‡æ‰€æœ‰è¡Œåˆ—å…ƒç´ è¿›è¡Œç´¯ä¹˜å¾—åˆ°çš„å…ƒç´ ä¸ªæ•°</li>
<li>rankè¡¨ç¤ºè¡Œ,åˆ—,â€¦è¿™äº›ä¸ªç»´åº¦çš„æ•°ç›®</li>
<li>depthè¡¨ç¤ºåµŒå¥—çš„æ·±åº¦,å³å•ä¸ªç»´åº¦å†…æ¯”å¦‚è¡Œæœ‰å‡ å±‚åµŒå¥—</li>
<li>coshape</li>
<li>cosizeç‰©ç†ç©ºé—´çš„å¤§å°,å¦‚æœæ•°æ®ä¸ç´§å‡‘,åˆ™cosizeä¼šå¤§äºsize</li>
</ul>
<p>åŒæ—¶layoutçš„ç¼–è¯‘å™¨å¸¸é‡åœ¨CuTeä¸­å¯ä»¥é€šè¿‡<code>Int&lt;N&gt;&#123;&#125;</code>ä½¿ç”¨,ä¹Ÿå¯ä»¥é€šè¿‡<code>_1</code>ä¸€ç±»çš„æ–¹å¼ä½¿ç”¨</p>
<p><strong>æ”¯æŒåˆ‡ç‰‡</strong>,ä¸åªå¯ä»¥é€šè¿‡coordinateè·å–å•ä¸ªå…ƒç´ çš„ç‰©ç†ä½ç½®,å¯ä»¥é€šè¿‡sliceè·å–ç¬¦åˆæˆ‘ä»¬é€‰æ‹©çš„ä¸€ç³»åˆ—å…ƒç´ çš„ç‰©ç†ä½ç½®,<strong>cuteæä¾›äº†å¯¹æŸä¸ªç»´åº¦å…¨é€‰çš„UnderScoreç±»å‹çš„å˜é‡<code>_</code></strong>(pythonæˆ–matlabç”¨çš„æ˜¯<code>:</code>)</p>
<p><strong>è¡¥é›†</strong>,å› ä¸ºLayoutæœ¬è´¨æ˜¯ä¸ªå‡½æ•°,ä»é›†åˆçš„è§’åº¦æ¥è®²,å°±æ˜¯å®šä¹‰äº†ä»domainåˆ°codomainçš„æ˜ å°„,æ•°æ®ç´§å‡‘åˆ™codomainæ²¡æœ‰ç©ºæ´,å¦åˆ™çš„è¯ä¼šäº§ç”Ÿç©ºæ´,å¯ä»¥åˆ©ç”¨è¡¥é›†æŠŠç©ºæ´çš„ä½ç½®å¡«å……äº†</p>
<p><strong>ä¹˜æ³•</strong>,æœ¬è´¨ä¸Šå°±æ˜¯å¯¹tensorçš„é‡å¤,ç±»ä¼¼äºpythonä¸­çš„<code>[2] * 3</code>å¾—åˆ°çš„æ˜¯<code>[2,2,2]</code>,å³<code>shape:(x,y)</code>å’Œ<code>shape:(z,w)</code>å¾—åˆ°çš„æ˜¯<code>shape:(x,y,z,w)</code>,è¯´äººè¯å°±æ˜¯å…ƒç´ ç”±x*yä¸ªä¹˜ä¸Šz*wä¸ªåå˜æˆäº†x*y*z*wä¸ªå…ƒç´ ,é‚£è¿™ä¸ªæ“ä½œçš„æ¯•ç«Ÿæ˜¯ä¸ªé«˜ç»´æ•°æ®,å®ƒè¦æ€ä¹ˆå˜åŒ–,å°±åˆ†åŒ–äº†å‡ ç§ä¸åŒçš„ä¹˜æ³•æ¨¡å¼å‡ºæ¥</p>
<p><strong>é™¤æ³•</strong>, layouté™¤æ³•æ˜¯å¯¹å±‚æ¬¡çš„åˆ’åˆ†,æ¯”å¦‚10 / 5 = 2;å¯¹äºlayoutè€Œè¨€å°±æ˜¯10 / 5 = (5,2) ; å…¶ä¸­å°æ‹¬å·ä¸­çš„5è¡¨ç¤ºçš„æ˜¯è¢«åˆ’åˆ†çš„å¤§å°,2æ˜¯è¢«åˆ’åˆ†çš„æ•°ç›®,å…·ä½“æ“ä½œè¿‡ç¨‹å°±æ˜¯æŠŠè¢«é™¤æ•°çš„layoutæŒ‰åˆ—æ‹‰æˆå¤§é•¿æ¡,æŠŠé™¤æ•°ä¹ŸæŒ‰åˆ—ä¸»åºå±•å¼€,ç„¶åä¸é™¤æ•°å¯¹åº”çš„ä½ç½®å…ƒç´ è¿›è¡Œä½ç½®å˜æ¢,å˜æ¢åçš„layoutæŒ‰è¡Œæ’åˆ—,å…¶ä¸­æœ€ç»ˆå¾—åˆ°çš„layoutçš„shapeçš„rank0æ˜¯é™¤æ•°çš„shape,rank1è¡¨ç¤ºçš„æ˜¯è¢«åˆ’åˆ†çš„æ•°ç›®</p>
<p><strong>å¤åˆå‡½æ•°å’Œé€†</strong> <mark>æš‚ä¸ç†è§£</mark></p>
<h3 id="tensor"><a class="markdownIt-Anchor" href="#tensor"></a> Tensor</h3>
<p>cuteä¸­çš„Tensorä¸æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­çš„Tensorä¸åŒ,è¿™ä¸ª<strong>Tensor = Layout + Storage</strong>(æŒ‡é’ˆè¡¨è¾¾çš„æ•°æ® / æ ˆä¸Šæ•°æ®(GPUè¡¨ç°ä¸ºå¯„å­˜å™¨)).æˆ‘ä»¬**<u>åœ¨cuteä¸­ç”¨Tensorå¤§å¤šæ•°æƒ…å†µåªæ˜¯ç”¨å®ƒçš„é€»è¾‘è¯­ä¹‰å’Œå˜æ¢,ä¸æ¶‰åŠæ•°æ®çš„å®é™…æ¬è¿</u>**(æ¯”å¦‚ç”±Tensorç”ŸæˆTensorä¹Ÿåªæ˜¯Layoutçš„è¡¨è¾¾å˜æ¢,å¹¶ä¸äº§ç”Ÿæ•°æ®å®ä½“çš„æ¬è¿).Tensoræ˜¯ä¸€ä¸ªå¯¹æ•°æ®è¡¨è¾¾è¿›è¡Œäº†æŠ½è±¡çš„å·¥å…·.Tensorçš„å­˜å‚¨ç©ºé—´å¯ä»¥æ˜¯æ ˆä¸Šå†…å­˜(å¯„å­˜å™¨,éœ€è¦é™æ€æ•°æ®)ä¹Ÿå¯ä»¥æ˜¯å †ä¸Š</p>
<h3 id="mma"><a class="markdownIt-Anchor" href="#mma"></a> MMA</h3>
<img src="https://s2.loli.net/2024/10/25/xdauKw1LvZ6kcqh.jpg" srcset="/img/loading.gif" lazyload alt="MMA_tutorial" style="zoom:67%;" />
<ul>
<li>
<p><code>MMAOpearation</code>ä¸å¾®æ¶æ„ç›¸å…³,ä¸»è¦å°è£…çš„æ˜¯ç‰¹å®šæ¶æ„åœ¨ç‰¹å®šMNKä¸‹ç‰¹å®šç²¾åº¦çš„æ–¹æ³•</p>
</li>
<li>
<p><code>MMA_Traits</code>ç±»ä¼¼äºC++ç‰¹å¾èƒå–,ç”¨æ¥æä¾›ä¸€äº›ä¿¡æ¯,æ¯”å¦‚ç±»å‹ç­‰,ç”¨ä½œæ¡¥æ¢</p>
</li>
<li>
<p><code>MMA_Atom</code>åŸå­æ“ä½œ,ç¡¬ä»¶æä¾›çš„èƒ½æ‰§è¡ŒçŸ©é˜µä¹˜æ³•çš„æœ€å°å•ä½</p>
</li>
<li>
<p><code>TiledMMA</code>åœ¨<code>MMA_Atom</code>ä¸Šè¿›è¡Œæ‰©å±•,ä»¥æä¾›æ›´å¤§çš„çŸ©é˜µä¹˜.è¿™é‡Œçš„tiledä½“ç°åœ¨æŸäº›æ–¹å‘(<code>MNK</code>)ä¸Šé‡å¤å‡ æ¬¡,å¯èƒ½é‡å¤çš„æ—¶å€™æ¶‰åŠåˆ°å¼€çº¿ç¨‹(<code>AtomLayoutMNK</code>),å¯èƒ½æ¶‰åŠåˆ°å¼€å¯„å­˜å™¨ä»¥é‡å¤è®¡ç®—(<code>ValLayoutMNK</code>ä»¥åŠåé¢æ›¿æ¢äº†å‰è€…çš„<code>PermutationMNK</code>)</p>
<p>å½“æˆ‘ä»¬<code>CopyOperation</code>é‡‡ç”¨<code>SM75_XXX_LDSM_X</code>æ¥è¿›è¡Œæ•°æ®s2rç§»åŠ¨æ—¶,ç”±<code>MMA_Atom</code>å’Œ<code>ValLayoutMNK</code>å…±åŒä½œç”¨,çœ‹æˆ‘ä»¬çš„<code>ldmatrix</code>æ˜¯<code>.x1 | .x2 | .x4</code></p>
</li>
<li>
<p><code>ThrMMA</code>æ¯•ç«Ÿæ•´ä¸ªCUDAè¿˜æ˜¯SIMTä¸‹çš„.è¿™ä¸€æ•´ä¸ªä»»åŠ¡(è¿™é‡ŒæŒ‡çš„æ˜¯TiledMMA,åˆ†å—çš„çŸ©é˜µ)åˆ’åˆ†åˆ°æŸä¸€ä¸ªçº¿ç¨‹å·ä¸‹çš„ä»»åŠ¡æ˜¯æ€ä¹ˆæ ·çš„,ç”±è¿™ä¸ªThread MMAé¢†å–å®ƒè‡ªå·±çš„è®¡ç®—ä»»åŠ¡</p>
</li>
<li>
<p><code>cute::gemm(tiledMMA,DThrMMA,AThrMMA,BThrMMA,CThrMMA)</code>å„ä¸ªçº¿ç¨‹é¢†åˆ°è‡ªå·±çš„è®¡ç®—ä»»åŠ¡å,ä¸€èµ·è°ƒç”¨è¿™ä¸ªå‡½æ•°,å¼€å§‹æ‰§è¡ŒçŸ©é˜µä¹˜</p>
</li>
</ul>
<h3 id="copy"><a class="markdownIt-Anchor" href="#copy"></a> Copy</h3>
<img src="https://s2.loli.net/2024/10/25/nXwp7y9rAZP5siW.png" srcset="/img/loading.gif" lazyload alt="COPY_tutorial" style="zoom:67%;" />
<p><strong>æ•°æ®æ¬è¿è¡¨ç¤ºä¸º<code>D=S</code>,å…¶ä¸­D,Séƒ½æ˜¯Tensor</strong></p>
<img src="https://s2.loli.net/2024/10/25/D4P8tjZU5CF6Xr7.png" srcset="/img/loading.gif" lazyload alt="gpu-storage-hierarhy" style="zoom:67%;" />
<p>è¿™å¼ å›¾çš„ä¸»è¦ä¸€ç‚¹,èµ°1,2ä¸¤æ¡è·¯åˆ°smemçš„,éƒ½æ˜¯Ampereæ¶æ„åŠå…¶ä¹‹åæ¶æ„çš„äº‹,ä¹‹å‰æ¶æ„çš„GPUéƒ½åªèƒ½èµ°3,å†èµ°4åˆ°smem.èµ°3åˆ°regçš„è¿™ç§æ–¹å¼åœ¨CopyOperationé‡Œæ˜¯è¢«æŠ½è±¡ä¸º<code>UniversalCopy</code>ç±»</p>
<ul>
<li>
<p><code>CopyOperation</code>å°è£…äº†ç¡¬ä»¶ç›¸å…³çš„æ‹·è´èƒ½åŠ›,ç±»åä»¥<code>SMxx_dstBitxnums_op_trans</code>å¤§è‡´ç»„æˆ,å…¶ä¸­opå°±æ˜¯è·Ÿæ¶æ„ç›¸å…³çš„æ‹·è´èƒ½åŠ›dstBit * numsä½“ç°çš„æ˜¯ç›®æ ‡å­˜å‚¨çš„ä½æ•°å’Œæ•°ç›®</p>
<ul>
<li>
<p><code>SM75_U32x1_LDSM_N</code>ä»£è¡¨äº†<code>ldmatrix</code>,ä»¥row-major,å³æ— éœ€å¼€å¯<code>.trans</code>é™å®šç¬¦,åœ¨<code>.x1</code>çš„æƒ…å†µä¸‹çš„æ•°æ®ç§»åŠ¨(<code>.x2</code>åˆ™æ˜¯<code>U32x2</code>,<code>.x4</code>åˆ™æ˜¯<code>U32x4</code>);</p>
</li>
<li>
<p><code>SM75_U16x2_LDSM_T</code>ä»£è¡¨äº†<code>ldmatrix</code>,ä»¥col-major,å³å¼€å¯<code>.trans</code>,åœ¨<code>.x1</code>çš„æƒ…å†µä¸‹çš„æ•°æ®ç§»åŠ¨(<code>.x2</code>åˆ™æ˜¯<code>U16x4</code>,<code>.x4</code>åˆ™æ˜¯<code>U16x8</code>);</p>
<p>è¿™æ—¶æ¶‰åŠåˆ°çš„è¡Œåœ°å€/åˆ—åœ°å€(<code>.trans</code>äº†),ä¼šåœ¨<code>make_tiled_copy_A/B()</code>ä¸­æ ¹æ®<code>TiledMMA</code>æä¾›çš„layoutå’Œ<code>Copy_Atom</code>è‡ªåŠ¨è®¡ç®—</p>
</li>
</ul>
</li>
<li>
<p><code>Copy_Traits</code>å°è£…äº†operationçš„çº¿ç¨‹æ•°ä»¥åŠæºæ•°æ®å’Œç›®æ ‡æ•°æ®çš„<code>Layout</code>(<mark>é‡Œé¢çš„çœ‹èµ·æ¥æ˜¯bit,ä¸è§£</mark>)è¿˜æœ‰ä¸€ä¸ª==<code>RefLayout</code>,æš‚ä¸æ¸…æ¥šæ€ä¹ˆä¸ªçº¿ç¨‹çº§çš„retile==</p>
</li>
<li>
<p><code>Copy_Atom</code>å°è£…ä¸Šé¢ä¿©,ç»§æ‰¿<code>Copy_Traits</code>,å¹¶æä¾›<code>call()</code>ç”¨äºå®ç°å¯¹åº•å±‚æŒ‡ä»¤çš„è°ƒç”¨å…¥å£</p>
</li>
<li>
<p><code>TiledCopy</code>å°è£…äº†<code>Copy_Atom</code>çš„<strong>é‡å¤æ–¹å¼</strong>,ä»¥åŠæä¾›äº†æ¯ä¸ªçº¿ç¨‹Layoutæè¿°çš„æ‹·è´ä»»åŠ¡çš„è·å¾—æ–¹æ³•<code>get_slice()</code>å’Œ<code>get_thread_slice()</code>,è¿™ä¿©å‡½æ•°returntypeæ˜¯<code>ThrCopy</code></p>
<p>å…¶ä¸­è¿™ä¸ªé‡å¤æ–¹å¼åŒ…å«äº†<strong>æ‰§è¡Œå•å…ƒçš„é‡å¤<code>ThrLayout</code></strong>,ä¹ŸåŒ…å«äº†<strong>æ¯ä¸ªæ‰§è¡Œå•å…ƒè´Ÿè´£çš„tensoråˆ†å—<code>ValLayout</code></strong>,å‰è€…æè¿°æ˜¯æè¿°çº¿ç¨‹æ’å¸ƒçš„layout,åè€…æ˜¯æè¿°1ä¸ªthreadæ‹·è´å¤šå°‘æ•°æ®çš„layout</p>
<p>äºŒè€…ç»„åˆå¾—åˆ°çš„<code>Tiler_MN</code>çš„shapeæ˜¯TiledCopyæ‰§è¡Œä¸€æ¬¡copyæ—¶,ä»S/D copyçš„tensor shape,æ— å…³stride!</p>
<p>æ­¤å¤–è¿˜æœ‰ä¸ª<code>TiledLayout_TV</code>çš„layout,å®ç°æ ¹æ®threadçš„id,æƒ³çŸ¥é“æŸä¸€ä¸ªthreadæ‰€è´Ÿè´£çš„tensoråˆ†å—çš„åæ ‡åœ¨è¿™ä¸ª<code>Tiler_MN</code>ä¸­å¤„åœ¨å“ªé‡Œ,è·å–è¿™ä¸ªcoordinate(coordinate -&gt; offsetçš„åæ–¹å‘).è¿™éœ€è¦æ ¹æ®<code>TiledLayout_TV</code>çš„layoutç®—å‡ºå®ƒçš„offset,ç„¶åæ ¹æ®è¿™ä¸ªoffsetä»<code>Tiler_MN</code>æ‰¾åˆ°coordinate,å…¶ä¸­è¿™ä¸ªlayoutçš„çº¿ç¨‹æ’å¸ƒæ˜¯åˆ—ä¸»åºçš„(<mark>ç–‘ä¼¼æ˜¯è§„åˆ™,è¿™é‡Œçš„ä¸œè¥¿æ¯”è¾ƒå¤æ‚,å»ºè®®é‡çœ‹å‚è€ƒæ–‡ä»¶2çš„ç¬¬2ç¯‡ç›¸å…³æ–‡ç« å’Œå®éªŒ</mark>)</p>
</li>
<li>
<p><code>ThrCopy</code>æä¾›<code>partition_S()</code>å‡½æ•°ç”¨ä»¥è·å–å½“å‰çº¿ç¨‹æ‹·è´æ‰€éœ€çš„srcå’Œdst,é€šè¿‡ä¸€ä¸ªåˆ’åˆ†ä¸€ä¸ªå¤§çš„tensoråˆ°æ‰€éœ€çš„tensor;<code>retile_S()</code>åˆ™æ˜¯åœ¨è¿™ä¹‹ä¸Šå˜æ¢å½¢çŠ¶ä»¥åŒ¹é…æ‹·è´æ‰€è¦æ±‚çš„å½¢çŠ¶</p>
</li>
<li>
<p><code>cute::copy</code></p>
</li>
</ul>
<p><mark>æ„Ÿè§‰COPYæ¯”MMAéš¾ç†è§£å¾ˆå¤š</mark></p>
<h3 id="swizzle"><a class="markdownIt-Anchor" href="#swizzle"></a> Swizzle</h3>
<p>åœ¨çŸ©é˜µä¹˜ä¸­,æ•°æ®æ¬è¿çš„è¿‡ç¨‹ä¸ºgmem -&gt; smem -&gt; reg,è¿™å…¶ä¸­é€»è¾‘ä¸Šæ¥è®²æŸä¸€ä¸ªCå—,å¯¹åº”çš„Aå—å’ŒBå—åœ¨gmemå’Œåœ¨regä¸Šæ˜¯ä¸€æ ·çš„(regçš„çŸ©é˜µå—ç”±warpä¸­çš„regæ•´ä½“è¡¨ç¤º),ä½†æ˜¯ç”±äºsmem bank conflictçš„å­˜åœ¨,<strong>æ•°æ®å­˜å‚¨åœ¨smemä¸Šå°±éœ€è¦æ²¿ç€bankçš„æ–¹å‘é”™å¼€</strong>,å³æŒ‰ç…§äºŒç»´åæ ‡æ¥è¯´æ˜¯icolæ–¹å‘é”™å¼€,é‚£æ€ä¹ˆé”™å¼€,é”™å¼€ä¹‹åçš„offsetå’‹å–,è¿˜æœ‰æ€ä¹ˆä»ä¸€ç»´å˜åˆ°äºŒç»´ä»¥å½¢æˆ(irow,icol)?è¿™äº›éƒ½å¯ä»¥äº¤ç”±Swizzleæ¥è§£å†³</p>
<p><strong>Swizzleä¸Layoutä¸€æ ·,éƒ½æ˜¯å‡½æ•°,Swizzleæ˜¯åµŒå¥—Layoutæ¥ä½¿ç”¨,Layoutæä¾›çš„æ˜¯offset/index,è€ŒSwizzleæä¾›çš„æ˜¯è§£å†³äº†smem bank conflictçš„offset,è¿™é‡Œå¯¹bank conflictçš„è§£å†³æ˜¯é€šè¿‡<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mi>c</mi><mi>o</mi><mi>l</mi><mo>=</mo><mi>i</mi><mi>r</mi><mi>o</mi><mi>w</mi><mo>âŠ•</mo><mi>i</mi><mi>c</mi><mi>o</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">icol = irow \oplus icol</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span></span></span></span>å®ç°çš„</strong></p>
<p><strong>Swizzleé€šè¿‡B,M,Sä¸‰ä¸ªå‚æ•°æ„é€ å‡ºä¸€ä¸ªäºŒç»´ç©ºé—´,ä¸€ç»´åæ ‡çš„å…ƒç´ å¯ä»¥æŒ‰æ­¤ç©ºé—´çš„å®šä¹‰è½¬æ¢æˆäºŒç»´åæ ‡,B,Sè¡¨ç¤ºæ–°ç©ºé—´çš„è¡Œåˆ—,Mè¡¨ç¤ºæ–°ç©ºé—´çš„åŸºæœ¬å…ƒç´ ,ç”±ä¸€ç»´åæ ‡ä¸‹çš„è¿ç»­å…ƒç´ ç»„æˆ,è¿™ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯ä»¥2ä¸ºåŸºåº•çš„</strong>,å¯ä»¥é€šè¿‡ldmatrixæŒ‡ä»¤,smem bankæ¥ç†è§£B,M,Sä¸‰ä¸ªå‚æ•°(ç»“åˆä¸‹å›¾):</p>
<ul>
<li>é¦–å…ˆ<strong>è®¾ç½®Mæ˜¯ä¸ºäº†æ„é€ æ–°å…ƒç´ </strong>,è¿™ä¸ªæ–°å…ƒç´ ä»ldmatrixçš„è§’åº¦æ¥ç†è§£,ä»¥<code>m8n8.x1.b16</code>æ¥çœ‹,T0åˆ°T7å„å ä¸€è¡Œçš„æ•°æ®,ä¸€è¡Œçš„8ä¸ª16ä½æ•°æ®è¿ç»­,T0åˆ°T7ä¹‹é—´ä»£è¡¨çš„è¯¥è¡Œé¦–ä¸ªå…ƒç´ åœ°å€ä¸è¦æ±‚è¿ç»­,ä¸€è¡Œ8ä¸ªå…ƒç´ ,çœ‹ä½œä¸€ä¸ªæ–°å…ƒç´ ,æ•…Mè®¾ç½®ä¸º3;</li>
<li>ç´§æ¥ç€æ–°å…ƒç´ çš„å¤§å°æ˜¯16Byte,smemçš„bankæ˜¯4Byteä¸€ä¸ª,æœ‰32ä¸ª,é‚£æ­¤æ—¶çš„æ–°bankå¤§å°æ˜¯16Byteä¸€ä¸ª,æœ‰8ä¸ªæ–°bank,æ¯ä¸ªæ–°bankå¯ä»¥æ”¾ä¸‹ä¸€ä¸ªæ–°å…ƒç´ ,æ”¯æŒå¹¶è¡Œè®¿é—®8ä¸ªæ–°å…ƒç´ ,å³æ­¤åˆ»æ–°bankæ•°ç›®ä¸º8,<strong>æ„é€ çš„Sä»æ–°bankæ•°ç›®æ¥</strong>,æ•…Sè®¾ç½®ä¸º3;</li>
<li>è¿›è¡Œldmatrix,è®¨è®ºæ­¤åˆ»å‘ç”Ÿçš„n-way bank conflict,æ­¤æ—¶å¯ä»¥<strong>è®¾ç½®Bå€¼ç”¨ä»¥è¡¨ç¤ºirow,æŒ‡ä»£é‡æ˜ å°„çš„åŸºæœ¬å•ä½</strong>,æ³¨æ„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi><mo>â‰¤</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">B \le S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span>,è¿™ä¸ªBçš„å–å€¼å®é™…ä¸Šå¯ä»¥ç»“åˆM,Så°†ä¸€è¡Œå¡«æ»¡bankæ¥çœ‹,è§‚å¯Ÿæ­¤åˆ»çš„bank conflictæƒ…å†µ,ä»è€Œå–å€¼</li>
</ul>
<p><img src="https://s2.loli.net/2025/03/07/8v5gBejcUw3zk9Y.png" srcset="/img/loading.gif" lazyload alt="CuTe-Swizzle-BMS" /></p>
<p>æ­¤å¤–é™¤äº†è§£å†³smem bank conflictçš„Swizzleå¤–,è¿˜æœ‰ä¸ª<strong>ç”¨äºçº¿ç¨‹å—çš„Swizzle,å¯ä»¥ç”¨æ¥å¢å¤§L2Cache hit</strong>,ä¸ªäººæ„Ÿè§‰ç±»ä¼¼äºæ‰§è¡Œé…ç½®å‚æ•°ä¸­å¯¹gridçš„X,Y,Zè¿›è¡Œä½ç½®å˜æ¢,ä½¿ä¹‹åœ¨è°ƒåº¦blockåˆ°SMä¸Šæ—¶å¯¹è€ƒè™‘L2 Cacheçš„å‘½ä¸­ç‡</p>
<h3 id="å‚è€ƒæ–‡ä»¶-2"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡ä»¶-2"></a> å‚è€ƒæ–‡ä»¶</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1696937812497235968">çŸ¥ä¹åšä¸»-reed-ä¸“æ </a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/anonymous-76-65-9/posts">çŸ¥ä¹åšä¸»-anonymous-cutlassä¸­çš„ä¸‰ç¯‡æ–‡ç« </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cutlass/blob/main/media/docs/cute/">nvidiaä¹‹cuteæ–‡æ¡£ <mark>è¾¹çœ‹è¾¹æ–½å·¥ğŸ˜­</mark></a></li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Layout/">Layout</a>
                    
                      <a class="hover-with-bg" href="/tags/Tensor/">Tensor</a>
                    
                      <a class="hover-with-bg" href="/tags/MMA/">MMA</a>
                    
                      <a class="hover-with-bg" href="/tags/Copy/">Copy</a>
                    
                      <a class="hover-with-bg" href="/tags/Swizzle/">Swizzle</a>
                    
                      <a class="hover-with-bg" href="/tags/cute/">cute</a>
                    
                      <a class="hover-with-bg" href="/tags/cutlass2-x/">cutlass2.x</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/10/02/convolution-winograd/">
                        <span class="hidden-mobile">convolution-winograd</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#gitalk-container', function() {
      Fluid.utils.createCssLink('/css/gitalk.css')
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', function() {
        var options = Object.assign(
          {"clientID":"1db059241d978c80eecd","clientSecret":"fa4f54290b2645c1dd4af84d9241dcb8c3e8e637","repo":"ayyBlog","owner":"ayyha","admin":["ayyha"],"language":"zh-CN","labels":["Gitalk"],"perPage":10,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token"},
          {
            id: '5b06f7f3de6b0c1eab664739cb2381bc'
          }
        )
        var gitalk = new Gitalk(options);
        gitalk.render('gitalk-container');
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  








  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?9c7ed39aa5906acb06d9f9cb7df236ae";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>

  <script type="text/javascript" src="/js/funnyTitle.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300,"hOffset":30,"vOffset":-50,"superSample":2},"mobile":{"show":false},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>
</html>
